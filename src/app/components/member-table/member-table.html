<div class="table-wrapper">
  @let selectedTypeVar = selectedType();
  @if (selectedTypeVar && members.length > 0 && !loading()) {
    <hxt-button
      (click)="exportToPdf(selectedTypeVar)"
    >
      Exportovat do PDF
    </hxt-button>

    <table>
      @if (anyBooleanAttributes()) {
        <tr class="filter-row">
          @for (attr of selectedTypeVar.attributes; track $index) {
            <th>
              @if (attr.type === 'boolean') {
                <hxt-tristate-toggle-switch
                  #booleanToggleFilter
                  [label]="{onLabel: 'Ano', offLabel: 'Ne', indeterminateLabel: 'V≈°e'}"
                  (stateChangeBoolean)="toggleBooleanFilter(attr.name, $event)"
                >
                </hxt-tristate-toggle-switch>
              }
            </th>
          }
          <th><hxt-button (click)="resetToggleFilters()" severity="secondary">Resetovat filtry</hxt-button></th>
        </tr>
      }
      <thead>
      <tr>
        @for (attr of selectedTypeVar.attributes; track $index) {
          <th>{{ attr.name }}</th>
        }
        <th>Akce</th>
      </tr>
      </thead>
      <tbody>
        @for (member of filteredMembers(); track $index) {
          <tr class="table-row">
            @if (editId === member.id) {
              @for (attr of selectedTypeVar.attributes; track $index) {
                <td>
                  @switch (attr.type) {
                    @case ('text') {
                      <input
                        type="text"
                        [(ngModel)]="editableMember[attr.name]"
                      />
                    }
                    @case ('number') {
                      <input
                        type="number"
                        [(ngModel)]="editableMember[attr.name]"
                      />
                    }
                    @case ('date') {
                      <input
                        type="date"
                        [(ngModel)]="editableMember[attr.name]"
                      />
                    }
                    @case ('boolean') {
                      <input
                        type="checkbox"
                        [(ngModel)]="editableMember[attr.name]"
                      />
                    }
                    @default {
                      <input
                        type="text"
                        [(ngModel)]="editableMember[attr.name]"
                      />
                    }
                  }
                </td>
              }
              <td>
                <span class="table-action-buttons">
                  <hxt-button (click)="saveEdit(member.id)">üíæ Ulo≈æit</hxt-button>
                  <hxt-button (click)="cancelEdit()">‚úñ Zru≈°it</hxt-button>
                </span>
              </td>
            } @else {
              @for (attr of selectedTypeVar.attributes; track $index) {
                <td>
                  @if (attr.type === 'boolean') {
                    <input
                      type="checkbox"
                      class="prevent-checkbox-click"
                      [checked]="member.data[attr.name]"
                    />
                  } @else {
                      {{ member.data[attr.name] }}
                  }
                </td>
              }
              <td>
                <span class="table-action-buttons">
                  <hxt-button (click)="editMember(member)">‚úèÔ∏è Upravit</hxt-button>
                  <hxt-button (click)="deleteMember(member.id)">üóëÔ∏è Smazat</hxt-button>
                </span>
              </td>
            }
          </tr>
        }
      </tbody>
    </table>
  }
  @if (filteredMembers().length === 0 && !loading()) {
    <img [src]="'assets/EmptyStateWText.svg'" class="emptyBackground" alt="empty">
  }
</div>
@if (loading()) {
  <hxt-loading-spinner></hxt-loading-spinner>
}
