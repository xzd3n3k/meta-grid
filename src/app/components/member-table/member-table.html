<h2>Seznam členů podle typu</h2>

<label>
  Vyber typ člena:
  <select [(ngModel)]="selectedTypeId" (change)="onTypeChange()">
    <option [value]="''" disabled>-- Vyber --</option>

    @for (memberType of memberTypes; track memberType.id) {
      <option [value]="memberType.id">{{ memberType.name }}</option>
    }
  </select>
</label>

@if (selectedType) {
  <div>
    <button (click)="exportToPdf()" [disabled]="members.length === 0">📄 Exportovat do PDF</button>
  </div>
}

@if (selectedType && members.length > 0) {
  <table>
    <thead>
    <tr>
      @for (attr of selectedType.attributes; track $index) {
        <th>{{ attr.name }}</th>
      }
      <th>Akce</th>
    </tr>
    </thead>
    <tbody>
      @for (member of members; track $index) {
        <tr>
          @if (editId === member.id) {
            @for (attr of selectedType.attributes; track $index) {
              <td>
                @switch (attr.type) {
                  @case ('text') {
                    <input
                      type="text"
                      [(ngModel)]="editableMember[attr.name]"
                    />
                  }
                  @case ('number') {
                    <input
                      type="number"
                      [(ngModel)]="editableMember[attr.name]"
                    />
                  }
                  @case ('date') {
                    <input
                      type="date"
                      [(ngModel)]="editableMember[attr.name]"
                    />
                  }
                  @case ('boolean') {
                    <input
                      type="checkbox"
                      [(ngModel)]="editableMember[attr.name]"
                    />
                  }
                  @default {
                    <input
                      type="text"
                      [(ngModel)]="editableMember[attr.name]"
                    />
                  }
                }
              </td>
            }
            <td>
              <button (click)="saveEdit(member.id)">💾 Uložit</button>
              <button (click)="cancelEdit()">✖ Zrušit</button>
            </td>
          } @else {
            @for (attr of selectedType.attributes; track $index) {
              <td>
                {{ member.data[attr.name] }}
              </td>
            }
            <td>
              <button (click)="editMember(member)">✏️ Upravit</button>
              <button (click)="deleteMember(member.id)">🗑️ Smazat</button>
            </td>
          }
        </tr>
      }
    </tbody>
  </table>
}

@if (selectedType && members.length === 0) {
  <p>Žádní členové tohoto typu.</p>
}
